id: dencun-opcodes-test
name: "Dencun Test"
timeout: 1h
config:
  walletPrivkey: ""
tasks:
- name: check_clients_are_healthy
  title: "Check if at least one client is ready"
  timeout: 5m
  config:
    minClientCount: 1

## EIP-1153: Transient storage opcodes
# deploy transient storage contract
- name: generate_transaction
  title: "Deploy EIP1153 test contract"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 2500000
    contractDeployment: true
    callData: "608060405234801561000f575f80fd5b5060015f1b604051610020906101d5565b8190604051809103905ff590508015801561003d573d5f803e3d5ffd5b505f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc5842bd60016040518263ffffffff1660e01b81526004016100d59190610230565b5f604051808303815f87803b1580156100ec575f80fd5b505af11580156100fe573d5f803e3d5ffd5b505050505f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc5842bd60026040518263ffffffff1660e01b815260040161015b9190610282565b5f604051808303815f87803b158015610172575f80fd5b505af1158015610184573d5f803e3d5ffd5b505050505f805c90505f81146101cf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101c6906102f5565b60405180910390fd5b50610313565b6101fb8061070383390190565b5f819050919050565b5f60ff82169050919050565b5f819050919050565b5f61021a610215610210846101e2565b6101f7565b6101eb565b9050919050565b61022a81610200565b82525050565b5f6020820190506102435f830184610221565b92915050565b5f819050919050565b5f61026c61026761026284610249565b6101f7565b6101eb565b9050919050565b61027c81610252565b82525050565b5f6020820190506102955f830184610273565b92915050565b5f82825260208201905092915050565b7f7472616e7369656e742073746f7261676520706f6c6c7574696f6e00000000005f82015250565b5f6102df601b8361029b565b91506102ea826102ab565b602082019050919050565b5f6020820190508181035f83015261030c816102d3565b9050919050565b6103e3806103205f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c806366e41cb7146100385780636b59084d14610042575b5f80fd5b61004061004c565b005b61004a6100d4565b005b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc5842bd60056040518263ffffffff1660e01b81526004016100a59190610278565b5f604051808303815f87803b1580156100bc575f80fd5b505af11580156100ce573d5f803e3d5ffd5b50505050565b5f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc5842bd60036040518263ffffffff1660e01b815260040161012d91906102ca565b5f604051808303815f87803b158015610144575f80fd5b505af1158015610156573d5f803e3d5ffd5b505050505f8054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fc5842bd60046040518263ffffffff1660e01b81526004016101b3919061031c565b5f604051808303815f87803b1580156101ca575f80fd5b505af11580156101dc573d5f803e3d5ffd5b505050505f805c90505f8114610227576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161021e9061038f565b60405180910390fd5b50565b5f819050919050565b5f60ff82169050919050565b5f819050919050565b5f61026261025d6102588461022a565b61023f565b610233565b9050919050565b61027281610248565b82525050565b5f60208201905061028b5f830184610269565b92915050565b5f819050919050565b5f6102b46102af6102aa84610291565b61023f565b610233565b9050919050565b6102c48161029a565b82525050565b5f6020820190506102dd5f8301846102bb565b92915050565b5f819050919050565b5f6103066103016102fc846102e3565b61023f565b610233565b9050919050565b610316816102ec565b82525050565b5f60208201905061032f5f83018461030d565b92915050565b5f82825260208201905092915050565b7f7472616e7369656e742073746f7261676520706f6c6c7574696f6e00000000005f82015250565b5f610379601b83610335565b915061038482610345565b602082019050919050565b5f6020820190508181035f8301526103a68161036d565b905091905056fea26469706673582212200f1112dc56d08150c608318186d868b6afedc8e3e489cf353f9d1321a9a1850f64736f6c63430008180033608060405234801561000f575f80fd5b506101de8061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063fc5842bd1461002d575b5f80fd5b610047600480360381019061004291906100d8565b610049565b005b5f805c9050808061005990610139565b9150508160ff167f3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba28260405161008f919061018f565b60405180910390a2805f5d5050565b5f80fd5b5f60ff82169050919050565b6100b7816100a2565b81146100c1575f80fd5b50565b5f813590506100d2816100ae565b92915050565b5f602082840312156100ed576100ec61009e565b5b5f6100fa848285016100c4565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f819050919050565b5f61014382610130565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361017557610174610103565b5b600182019050919050565b61018981610130565b82525050565b5f6020820190506101a25f830184610180565b9291505056fea26469706673582212206785b2b2a58b397b1adcd2a940ed319cbaef19adc1a7218428eddc5938cbba7c64736f6c63430008180033"
    failOnReject: true
    contractAddressResultVar: "eip1153TestContractAddr"
    expectEvents:
      - { topic0: "0x3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba2", topic1: "0x0000000000000000000000000000000000000000000000000000000000000001", data: "0x0000000000000000000000000000000000000000000000000000000000000001" }
      - { topic0: "0x3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba2", topic1: "0x0000000000000000000000000000000000000000000000000000000000000002", data: "0x0000000000000000000000000000000000000000000000000000000000000002" }
  configVars:
    privateKey: "walletPrivkey"
# check transient storage across multiple calls in same transaction
- name: generate_transaction
  title: "Call EIP1153 test contract: test1()"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x6b59084d"
    expectEvents:
      - { topic0: "0x3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba2", topic1: "0x0000000000000000000000000000000000000000000000000000000000000003", data: "0x0000000000000000000000000000000000000000000000000000000000000001" }
      - { topic0: "0x3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba2", topic1: "0x0000000000000000000000000000000000000000000000000000000000000004", data: "0x0000000000000000000000000000000000000000000000000000000000000002" }
  configVars:
    targetAddress: "eip1153TestContractAddr"
    privateKey: "walletPrivkey"
# check transient storage across multiple transactions in same block
- name: generate_transaction
  title: "Call EIP1153 test contract: test2() (1st time)"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x66e41cb7"
    awaitReceipt: false
  configVars:
    targetAddress: "eip1153TestContractAddr"
    privateKey: "walletPrivkey"
- name: generate_transaction
  title: "Call EIP1153 test contract: test2() (2nd time)"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x66e41cb7"
    expectEvents:
      - { topic0: "0x3d1918317addb678cd21da9d5afce2b6633380abe49c8a1a08c75b5cc9cb8ba2", topic1: "0x0000000000000000000000000000000000000000000000000000000000000005", data: "0x0000000000000000000000000000000000000000000000000000000000000001" }
  configVars:
    targetAddress: "eip1153TestContractAddr"
    privateKey: "walletPrivkey"


## EIP-4844: Blob transactions
# deploy blob transactions test contract
- name: generate_transaction
  title: "Deploy EIP4844 test contract"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 2500000
    contractDeployment: true
    callData: "608060405234801561000f575f80fd5b506101648061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c80636b59084d1461002d575b5f80fd5b610035610037565b005b5f5b600681101561008d575f81499050817f164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab08260405161007791906100e4565b60405180910390a2508080600101915050610039565b505f4a90507fa1d8c145b54161177103f51f768fcd325948860da2f90ac8adbd065303bdde9d816040516100c19190610115565b60405180910390a150565b5f819050919050565b6100de816100cc565b82525050565b5f6020820190506100f75f8301846100d5565b92915050565b5f819050919050565b61010f816100fd565b82525050565b5f6020820190506101285f830184610106565b9291505056fea2646970667358221220e86435299c0e8170e89853ba78a5a987357716b26d8f54a7529233ebcb97559b64736f6c63430008180033"
    failOnReject: true
    contractAddressResultVar: "eip4844TestContractAddr"
  configVars:
    privateKey: "walletPrivkey"
# check blob trnasaction contract call with eip4844 specific opcodes
- name: generate_transaction
  title: "Call EIP4844 test contract: test1() with 2 blob sidecars"
  config:
    feeCap: 5000000000 # 5 gwei
    blobFeeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x6b59084d"
    blobTxType: true
    blobData: "identifier,repeat:0x42:100000;0x00"
    expectEvents:
      # EIP-4844: blobhash([0,5])
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000000", data: "0x01c67aca3f358cc1087277e0145a4b26c5a99a6196f816d232076aefb91d947a" }
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000001", data: "0x0114f65cef296895d5dc27787cd621027aad2e0db78bbbeb1ba543c7ec4b9973" }
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000002", data: "0x010657f37554c781402a22917dee2f75def7ab966d7b770905398eba3c444014" }
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000003", data: "0x0000000000000000000000000000000000000000000000000000000000000000" }
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000004", data: "0x0000000000000000000000000000000000000000000000000000000000000000" }
      - { topic0: "0x164a8ff8b21654fcb500a8a9e56e496fec47640fa9cecb75de70cac1121a2ab0", topic1: "0x0000000000000000000000000000000000000000000000000000000000000005", data: "0x0000000000000000000000000000000000000000000000000000000000000000" }
      # EIP-7516: blobbasefee()
      - { topic0: "0xa1d8c145b54161177103f51f768fcd325948860da2f90ac8adbd065303bdde9d" }
  configVars:
    targetAddress: "eip4844TestContractAddr"
    privateKey: "walletPrivkey"


## EIP-5656: MCOPY - Memory copying instruction
# deploy MCOPY test contract
- name: generate_transaction
  title: "Deploy EIP5656 test contract"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 2500000
    contractDeployment: true
    callData: "6080604052348015600e575f80fd5b50607a80601a5f395ff3fe6080604052348015600e575f80fd5b50600436106026575f3560e01c80636b59084d14602a575b5f80fd5b60306032565b005b385f8039604060205f5e6001605e5fa156fea2646970667358221220d931d1ed207d2b89a036c2454189c728dc72bcb4abb65e0d393d226fa212e4b164736f6c63430008180033"
    failOnReject: true
    contractAddressResultVar: "eip5656TestContractAddr"
  configVars:
    privateKey: "walletPrivkey"
# check mcopy opcode
- name: generate_transaction
  title: "Call EIP5656 test contract: test1()"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x6b59084d"
    expectEvents:
      - { topic0: "0x0000000000000000000000000000000000000000000000000000000000000001", data: "0x084d14602a575b5f80fd5b60306032565b005b385f8039604060205f5e6001605e5fa156fea2646970667358221220d931d1ed207d2b89a036c2454189c728dc5e5fa156fea2646970667358221220d931d1ed207d2b89a036c2454189c7" }
  configVars:
    targetAddress: "eip5656TestContractAddr"
    privateKey: "walletPrivkey"


## EIP-4788: Beacon block root in the EVM
# deploy EIP4788 test contract
- name: generate_transaction
  title: "Deploy EIP4788 test contract"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 2500000
    contractDeployment: true
    callData: "608060405234801561000f575f80fd5b5060405161001c90610079565b604051809103905ff080158015610035573d5f803e3d5ffd5b505f806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610086565b6101758061040d83390190565b61037a806100935f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c8063661a052f146100385780636b59084d14610068575b5f80fd5b610052600480360381019061004d91906101ca565b610072565b60405161005f919061020d565b60405180910390f35b610070610112565b005b5f805f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663661a052f836040518263ffffffff1660e01b81526004016100cc9190610235565b602060405180830381865afa1580156100e7573d5f803e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061010b9190610278565b9050919050565b5f600190505b6064811015610190575f600c8261012f91906102d0565b4261013a9190610311565b90505f61014682610072565b905081837f3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c383604051610179919061020d565b60405180910390a350508080600101915050610118565b50565b5f80fd5b5f819050919050565b6101a981610197565b81146101b3575f80fd5b50565b5f813590506101c4816101a0565b92915050565b5f602082840312156101df576101de610193565b5b5f6101ec848285016101b6565b91505092915050565b5f819050919050565b610207816101f5565b82525050565b5f6020820190506102205f8301846101fe565b92915050565b61022f81610197565b82525050565b5f6020820190506102485f830184610226565b92915050565b610257816101f5565b8114610261575f80fd5b50565b5f815190506102728161024e565b92915050565b5f6020828403121561028d5761028c610193565b5b5f61029a84828501610264565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6102da82610197565b91506102e583610197565b92508282026102f381610197565b9150828204841483151761030a576103096102a3565b5b5092915050565b5f61031b82610197565b915061032683610197565b925082820390508181111561033e5761033d6102a3565b5b9291505056fea26469706673582212205a0be89fb87b867b4d35bc4a66b6cc0ece3336c303d29e47fe63a23a6fabc1e564736f6c63430008180033608060405234801561000f575f80fd5b506101588061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063661a052f1461002d575b5f80fd5b610047600480360381019061004291906100c6565b61005d565b6040516100549190610109565b60405180910390f35b5f805f9050825f5260205f60205f720f3df6d732807ef1319fb7b8bb8522d0beac025afa8061008a57815f525b60205ff35b5f80fd5b5f819050919050565b6100a581610093565b81146100af575f80fd5b50565b5f813590506100c08161009c565b92915050565b5f602082840312156100db576100da61008f565b5b5f6100e8848285016100b2565b91505092915050565b5f819050919050565b610103816100f1565b82525050565b5f60208201905061011c5f8301846100fa565b9291505056fea264697066735822122076d324de1815eac3fe691ddc651ac9ca0a38239db982c2325ce8ca6a06cef69e64736f6c63430008180033"
    failOnReject: true
    contractAddressResultVar: "eip4788TestContractAddr"
  configVars:
    privateKey: "walletPrivkey"
# check beacon block roots precompile
- name: generate_transaction
  title: "Call EIP4788 test contract: test1()"
  config:
    feeCap: 5000000000 # 5 gwei
    gasLimit: 1000000
    callData: "0x6b59084d"
    expectEvents:
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000001" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000002" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000003" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000004" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000005" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000006" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000007" }
      - { topic0: "0x3724e815ca923f1257969b6e6571672d65051d39c5b90eafb240a33b32b387c3", topic1: "0x0000000000000000000000000000000000000000000000000000000000000063" }
  configVars:
    targetAddress: "eip4788TestContractAddr"
    privateKey: "walletPrivkey"


# check chain status
- name: run_tasks_concurrent
  title: "Check chain stability"
  timeout: 1h
  config:
    tasks:
    - name: check_consensus_reorgs
      title: "Check consensus reorgs"
      config:
        maxReorgsPerEpoch: 2
        minCheckEpochCount: 1
    - name: check_consensus_forks
      title: "Check consensus forks"
      config:
        minCheckEpochCount: 1
